<html lang="es">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>PASECO</title>
  </head>
  <body>
    <div class="container">
      <div class="row justify-content-center">
	    <div class="col-12">
	      <h2>Boleta de Pago</h2>
	    </div>
	  </div>
	  <div class="row form_fieldset">
	    <div class="col-4 mb-2 mt-2">
	      <label for="">Nombre</label>
	      <p><%= @payrole.name %></p>
	    </div>
	    <div class="col-4 mb-2 mt-2">
	      <label for="">Fecha de Inicio</label>
	      <p><%= @payrole.start_date %></p>
	    </div>
	    <div class="col-4 mb-2 mt-2">
	      <label for="">Fecha de Fin</label>
	      <p><%= @payrole.end_date %></p>
	    </div>
	  </div>
	  <div class="row form_fieldset">
		  <div  class="col-12 mt-2">
		    <legend><%= @employee.name %>: <%= number_to_currency(@employee.payrole_details.where(role_id: @payrole.id).first.net_salary, unit: '₡') rescue nil %> </legend>
		    <div id="table1" class="table-responsive">
	          <table class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
	            <thead class="thead-dark">
	              <tr>
	              	<th style="border: 1px solid" width="11.11%">Fecha</th>
	                <th style="border: 1px solid" width="11.11%">Puesto</th>
	                <th style="border: 1px solid" width="11.11%">Turno</th>
	                <th style="border: 1px solid" width="11.11%">Sub-Puesto</th>
	                <th style="border: 1px solid" width="11.11%">Horas</th>
	                <th style="border: 1px solid" width="11.11%">Salario Mínimo</th>
	                <th style="border: 1px solid" width="11.11%">Feriado</th>
	                <th style="border: 1px solid" width="11.11%">Nº Horas Extras</th>
	                <th style="border: 1px solid" width="11.11%">Pago Horas Extras</th>
	              </tr>
	            </thead>
	            <tbody>
	              <% begin %>
	              <% @employee.payrole_details.where(role_id: @payrole.id).first.detail_lines.order(date: :asc).each do |line|  %>
	                <tr>
	                	<td style="border: 1px solid"><%= line.date %></td>
	                  <td style="border: 1px solid"><%= line.stall.name %></td>
	                  <td style="border: 1px solid"><%= line.shift.name %></td>
	                  <td style="border: 1px solid"><%= line.substall %></td>
	                  <td style="border: 1px solid"><%= line.hours.to_f.round(2) %></td>
	                  <td style="border: 1px solid"><%= number_to_currency(line.salary.to_f.round(2), unit: '₡') %></td>
	                  <td style="border: 1px solid"><%= number_to_currency(line.holiday.to_f.round(2), unit: '₡')  %></td>
	                  <td style="border: 1px solid"><%= line.extra_hours.to_f.round(2) %></td>
	                  <td style="border: 1px solid"><%= number_to_currency(line.extra_salary.to_f.round(2), unit: '₡') %></td>
	                </tr>
	              <% end %>
	              <% rescue => ex %>
	                <% logger.error ex.message %>
	              <%end %>
	              <tr>
	                <td style="border: 1px solid"></td>
	                <td style="border: 1px solid"></td>
	                <td style="border: 1px solid"></td>
	                <td style="border: 1px solid"></td>
	                <td style="border: 1px solid"></td>
	                <td style="border: 1px solid"></td>
	                <td style="border: 1px solid"></td>
	                <td style="border: 1px solid"></td>
	                <td style="border: 1px solid"></td>
	              </tr>
	            </tbody>
	          </table>
	        </div>
	        <div id="table2" class="table-responsive mt-4">
	          <table class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
	            <thead class="thead-dark">
	              <tr>
	              	<th style="border: 1px solid" width="14.28%">Fecha</th>
	                <th style="border: 1px solid" width="14.28%">Víaticos</th>
	                <th style="border: 1px solid" width="14.28%">Pagos Extras</th>
	                <th style="border: 1px solid" width="14.28%">Motivo Pagos Extras</th>
	                <th style="border: 1px solid" width="14.28%">Deducciones</th>
	                <th style="border: 1px solid" width="14.28%">Motivo Deducciones</th>
	                <th style="border: 1px solid" width="14.28%">Comentario</th>
	              </tr>
	            </thead>
	            <tbody>
	              <% begin %>
	              <% @employee.payrole_details.where(role_id: @payrole.id).first.detail_lines.order(date: :asc).each do |line|  %>
	                <tr>
	                  <td style="border: 1px solid"><%= line.date %></td>
	                  <td style="border: 1px solid"><%= number_to_currency(line.viatical.to_f.round(2), unit: '₡') %></td>
	                  <td style="border: 1px solid"><%= number_to_currency(line.extra_payment.to_f, unit: '₡') %></td>
	                  <td style="border: 1px solid"><%= line.extra_payment_reason %></td>
	                  <td style="border: 1px solid"><%= number_to_currency(line.deductions.to_f, unit: '₡') %></td>
	                  <td style="border: 1px solid"><%= line.deductions_reason %></td>
	                  <td style="border: 1px solid"><%= line.comments %></td>
	                </tr>
	              <% end %>
	              <% rescue => ex %>
	                <% logger.error ex.message %>
	              <%end %>
	              <tr>
	                <td style="border: 1px solid"></td>
	                <td style="border: 1px solid"></td>
	                <td style="border: 1px solid"></td>
	                <td style="border: 1px solid"></td>
	                <td style="border: 1px solid"></td>
	                <td style="border: 1px solid"></td>
	                <td style="border: 1px solid"></td>
	              </tr>
	            </tbody>
	          </table>
	        </div>
	        <div id="table3" class="table-responsive mt-3 mb-5">
	          <table class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
	            <thead class="">
	              <tr>
	              	<th scope="" width="50%"></th>
	                <th scope="" width="50%"></th>
	              </tr>
	            </thead>
	            <tbody>
	              <tr>
	              	<td>Salario Base</td>
	                <td><%= number_to_currency(@employee.payrole_details.where(role_id: @payrole.id).first.base_salary, unit: '₡') rescue nil %></td>
	              </tr>
	              <tr>
	              	<td>Horas Extras</td>
	                <td><%= number_to_currency(@employee.payrole_details.where(role_id: @payrole.id).first.extra_salary, unit: '₡') rescue nil %></td>
	              </tr>
	              <tr>
	              	<td>Víaticos</td>
	                <td><%= number_to_currency(@employee.payrole_details.where(role_id: @payrole.id).first.viatical, unit: '₡') rescue nil %></td>
	              </tr>
	              <tr>
	              	<td>Pagos Adicionales</td>
	                <td><%= number_to_currency(@employee.payrole_details.where(role_id: @payrole.id).first.extra_payments, unit: '₡') rescue nil %></td>
	              </tr>
	              <tr>
	              	<td>Salario Bruto</td>
	                <td><%= number_to_currency(@employee.payrole_details.where(role_id: @payrole.id).first.gross_salary, unit: '₡') rescue nil %></td>
	              </tr>
	              <tr>
	              	<td>Deducción CCSS</td>
	                <td><%= number_to_currency(@employee.payrole_details.where(role_id: @payrole.id).first.ccss_deduction, unit: '₡') rescue nil %></td>
	              </tr>
	              <tr>
	              	<td>Otras Deducciones</td>
	                <td><%= number_to_currency(@employee.payrole_details.where(role_id: @payrole.id).first.deductions, unit: '₡') rescue nil %></td>
	              </tr>
	              <tr>
	              	<td>Salario Neto</td>
	                <td><%= number_to_currency(@employee.payrole_details.where(role_id: @payrole.id).first.net_salary, unit: '₡') rescue nil %></td>
	              </tr>
	            </tbody>
	          </table>
	        </div>
		  </div>
		</div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
</html>