<div class="row justify-content-center">
  <div class="col-12">
    <p id="notice"><%= notice %></p>
    <h2>Planilla de Empleados</h2><br>
  </div>
</div>

<div class="row form_fieldset">
  <div  class="col-12 mt-4">
    <legend>Información General</legend>
  </div>
  <div class="col-lg-4 mb-2 mt-2">
    <label for="">Nombre</label>
    <p><%= @payrole.name %></p>
  </div>
  <div class="col-lg-4 mb-2 mt-2">
    <label for="">Fecha de Inicio</label>
    <p><%= @payrole.start_date %></p>
  </div>
  <div class="col-lg-4 mb-2 mt-2">
    <label for="">Fecha de Fin</label>
    <p><%= @payrole.end_date %></p>
  </div>
</div>
<div class="row form_fieldset">
  <div  class="col-12 mt-4">
    <legend>Información de los Pagos: <%= @employee.name %></legend>
    <div class="card">
      <div class="card-body">
        <div id="table" class="table-responsive">
          <table class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
            <thead class="thead-dark">
              <tr>
                <th style="border: 1px solid" scope="col">Puesto/Sub-Puesto</th>
                <th style="border: 1px solid" scope="col">Fecha</th>
                <th style="border: 1px solid" scope="col">Turno</th>
                <th style="border: 1px solid" scope="col">Horas</th>
                <th style="border: 1px solid" scope="col">Salario Mínimo</th>
                <th style="border: 1px solid" scope="col">Feriado</th>
                <th style="border: 1px solid" scope="col">Nº Horas Extras</th>
                <th style="border: 1px solid" scope="col">Pago Horas Extras</th>
                <th style="border: 1px solid" scope="col">Víaticos</th>
                <th style="border: 1px solid" scope="col">Pagos Extras</th>
                <th style="border: 1px solid" scope="col">Motivo Pagos Extras</th>
                <th style="border: 1px solid" scope="col">Deducciones</th>
                <th style="border: 1px solid" scope="col">Motivo Deducciones</th>
                <th style="border: 1px solid" scope="col">Comentario</th>
              </tr>
            </thead>
            <tbody>
              <% @lines =  @payrole.role_lines.where(employee: @employee).order(stall_id: :asc, date: :asc) %>
              <% if @lines %>

                <% @total_day_salary     = 0 %>
                <% @total_extra_hours    = 0 %>
                <% @total_extra_salary   = 0 %>
                <% @total_extra_payments = 0 %>
                <% @total_deductions     = 0 %>
                <% @total_viatical       = 0 %>
                <% @total_holiday        = 0 %>

                <% @lines.each do |line| %>
                  <% @employee.calculate_day_salary(line) %>
                  <% @employee.calculate_daily_viatical(line) %>

                  <% @total_day_salary     += @employee.day_salary %>
                  <% @total_extra_hours    += @employee.extra_day_hours %>
                  <% @total_extra_salary   += @employee.extra_day_salary %>
                  <% @total_extra_payments += line.extra_payments.to_f %>
                  <% @total_deductions     += line.deductions.to_f %>
                  <% @total_viatical       += @employee.viatical %>
                  <% @total_holiday        += @employee.holiday %>

                  <tr>
                    <td style="border: 1px solid"><%= line.stall.name %> en <%= line.substall %></td>
                    <td style="border: 1px solid"><%= line.date %></td>
                    <td style="border: 1px solid"><%= line.shift.name %></td>
                    <td style="border: 1px solid"><%= @employee.normal_day_hours.round(2) %></td>
                    <td style="border: 1px solid"><%= @employee.day_salary.round(2) %></td>
                    <td style="border: 1px solid"><%= @employee.holiday.round(2) %></td>
                    <td style="border: 1px solid"><%= @employee.extra_day_hours.round(2) %></td>
                    <td style="border: 1px solid"><%= @employee.extra_day_salary.round(2) %></td>
                    <td style="border: 1px solid"><%= @employee.viatical.round(2) %></td>
                    <td style="border: 1px solid"><%= line.extra_payments %></td>
                    <td style="border: 1px solid"><%= line.extra_payments_description %></td>
                    <td style="border: 1px solid"><%= line.deductions %></td>
                    <td style="border: 1px solid"><%= line.deductions_description %></td>
                    <td style="border: 1px solid"><%= line.comment %></td>
                  </tr>
                <% end %>
                <% @employee.calculate_payment(@lines.length, @total_day_salary, @total_extra_hours, @total_extra_salary, @total_viatical, @total_extra_payments, @total_deductions, @total_holiday) %>
              <%end %>
              <tr>
                <td style="border: 1px solid"></td>
                <td style="border: 1px solid"></td>
                <td style="border: 1px solid"></td>
                <td style="border: 1px solid"></td>
                <td style="border: 1px solid"></td>
                <td style="border: 1px solid"></td>
                <td style="border: 1px solid"></td>
                <td style="border: 1px solid"></td>
                <td style="border: 1px solid"></td>
                <td style="border: 1px solid"></td>
                <td style="border: 1px solid"></td>
                <td style="border: 1px solid"></td>
                <td style="border: 1px solid"></td>
                <td style="border: 1px solid"></td>
              </tr>
            </tbody>
          </table>
        </div>
        <H3 class="mt-4">Resumen de Pago:</H3>
        <H4 style="color: #000000" class="alert-success">Días Laborados: <%= @employee.total_days %></H4>
        <H4 style="color: #000000" class="alert-info">Salario Base:   <%= (@employee.total_day_salary + @employee.total_holidays).round(2) %></H4>
        <H4 style="color: #000000" class="alert-success">Cantidad de Horas Extras: <%= @employee.total_extra_hours.round(2) %></H4>
        <H4 style="color: #000000" class="alert-info">Salario Horas Extras: <%= @employee.total_extra_salary.round(2) %></H4>
        <H4 style="color: #000000" class="alert-success">Pago por Víaticos: <%= @employee.total_viatical.round(2) %></H4>
        <H4 style="color: #000000" class="alert-info">Pagos Extras: <%= @employee.total_exta_payments.round(2) %></H4>
        <H4 style="color: #000000" class="alert-success">Deducciones: <%= @employee.total_deductions.round(2) %></H4>
        <H4 style="color: #000000" class="alert-info">Salario Bruto: <%= (@employee.total_day_salary + @employee.total_holidays + @employee.total_extra_salary + @employee.total_viatical + @employee.total_exta_payments - @employee.total_deductions).round(2) %></H4>
        <H4 style="color: #000000" class="alert-success">Deducción CCSS: <%= @employee.ccss_deduction.round(2) %></H4>
        <H4 style="color: #000000" class="alert-info">Salario Neto: <%= @employee.net_salary.round(2) %></H4>
      </div>
    </div>
  </div>
</div>
<% if current_user.employee? %>
  <%= link_to 'Atrás', admin_payroles_path %>
<% else %>
  <%= link_to 'Atrás', admin_payrole_path(@payrole) %>
<% end %>