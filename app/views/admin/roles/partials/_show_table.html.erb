<div id="table" data-lines="<%= @role.role_lines.to_json %>" data-shifts="<%= Shift.all.to_json %>" class="table-responsive">
  <table class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
    <thead class="thead-dark">
      <tr>
        <th scope="col">Nombre</th>
        <% @dates = (Date.strptime(Date.parse(@role.start_date).strftime("%Y-%m-%d"), "%Y-%m-%d")..Date.strptime(Date.parse(@role.end_date).strftime("%Y-%m-%d"), "%Y-%m-%d")).map{|d| d.strftime "%m/%d/%Y" } %>
        <% @dates.each do |date| %>
          <th scope="col"><%= date %></th>
       <% end -%>
      </tr>
    </thead>
    <tbody>
      <% @employees = [] %>
      <% @role.role_lines.where(stall_id: stall.id).each do |line| %>
        <% @employees << line.employee %>
      <% end -%>

      <% @employees = @employees.uniq %>

      <% @employees.each_with_index  do |employee, index|%>
        <% @employee_dates = @dates %>
        <tr>
          <td id="<%= stall.id.to_s + employee.id.to_s %>" style="border: 1px solid"> <%= employee.name %></td>
          <% @dates.each_with_index  do |date, index|%>
            <% @employee_dates = @dates %>
            <td id="<%= stall.id.to_s + employee.id.to_s + date %>" style="border: 1px solid">Sin Registro</td>
          <% end -%>
        </tr>
      <% end -%>
    </tbody>
  </table>
</div>

<script type="">
  $(document).ready(function(){

    var lines = JSON.parse(document.querySelector('#table').dataset.lines)
    var shifts = JSON.parse(document.querySelector('#table').dataset.shifts)

    for (var i = 0; i < lines.length; i++) {
      for (var j = 0; j < shifts.length; j++) {
        if (lines[i].shift_id == shifts[j].id) {
          try{
            var td = document.getElementById(lines[i].stall_id.toString() + lines[i].employee_id.toString() +  lines[i].date );
            if (shifts[j].name != "Libre") {
              td.innerHTML = shifts[j].name + " en " + lines[i].substall;
            }
            else{
              td.innerHTML = shifts[j].name;
            }
            if (lines[i].comment) {
              td.title = lines[i].comment;
              td.style.borderColor = "red";
            }
          }catch(err){

          }
        }
      }
    }
  });
</script>